import React, { useState } from 'react';
import { Check, Home, DollarSign, MapPin, Building, BedDouble, Bath, Calendar, ArrowRight } from 'lucide-react';

const AgentAllySurvey = () => {
  // State to track current step and all answers
  const [currentStep, setCurrentStep] = useState(0);
  const [answers, setAnswers] = useState({
    userType: '',
    // Buyer specific
    location: '',
    priceMin: '',
    priceMax: '',
    bedrooms: '',
    bathrooms: '',
    homeType: '',
    sqftMin: '',
    moveInTimeframe: '',
    preApproved: '',
    preApprovedAmount: '',
    additionalFeatures: [],
    // Seller specific
    propertyAddress: '',
    currentHomeType: '',
    currentBedrooms: '',
    currentBathrooms: '',
    currentSqft: '',
    lotSize: '',
    yearBuilt: '',
    lastRenovated: '',
    sellingTimeframe: '',
    reasonForSelling: '',
    expectedPrice: '',
    // Common fields
    firstName: '',
    lastName: '',
    email: '',
    phone: '',
    contactPreference: '',
    agreeToTerms: false
  });

  // Features checklist options
  const featureOptions = [
    'Garage', 'Basement', 'Pool', 'Yard', 'Deck/Patio', 
    'Fireplace', 'Open Floor Plan', 'Updated Kitchen', 
    'Updated Bathrooms', 'Central AC', 'Smart Home'
  ];

  // Home type options
  const homeTypeOptions = [
    'Single-family Home', 'Townhouse', 'Condo/Apartment', 
    'Multi-family Home', 'New Construction', 'Fixer-upper'
  ];

  // Function to update answers
  const handleChange = (field, value) => {
    setAnswers({
      ...answers,
      [field]: value
    });
  };

  // Function to handle checkbox changes
  const handleCheckboxChange = (feature) => {
    const currentFeatures = [...answers.additionalFeatures];
    
    if (currentFeatures.includes(feature)) {
      // Remove if already selected
      const updatedFeatures = currentFeatures.filter(f => f !== feature);
      setAnswers({
        ...answers,
        additionalFeatures: updatedFeatures
      });
    } else {
      // Add if not selected
      setAnswers({
        ...answers,
        additionalFeatures: [...currentFeatures, feature]
      });
    }
  };

  // Function to move to next step
  const nextStep = () => {
    // Skip steps based on user type
    if (currentStep === 0) {
      if (answers.userType === 'buyer') {
        setCurrentStep(1); // Go to buyer questions
      } else if (answers.userType === 'seller') {
        setCurrentStep(100); // Go to seller questions
      } else if (answers.userType === 'both') {
        setCurrentStep(1); // Start with buyer questions, then will go to seller
      }
    } else {
      setCurrentStep(currentStep + 1);
    }
  };

  // Submit function
  const handleSubmit = () => {
    console.log('Survey Submitted:', answers);
    setCurrentStep(1000); // Move to thank you screen
  };

  // Determine if the current step can proceed
  const canProceed = () => {
    switch(currentStep) {
      case 0:
        return answers.userType !== '';
      case 1:
        return answers.location !== '';
      case 2:
        return answers.priceMin !== '' && answers.priceMax !== '';
      case 3:
        return answers.bedrooms !== '' && answers.bathrooms !== '';
      case 4:
        return answers.homeType !== '';
      case 5:
        return answers.sqftMin !== '';
      case 6:
        return answers.moveInTimeframe !== '';
      case 7:
        return answers.preApproved !== '';
      case 8:
        return answers.preApproved === 'no' || answers.preApprovedAmount !== '';
      case 9:
        return true; // Additional features is optional
      case 100:
        return answers.propertyAddress !== '';
      case 101:
        return answers.currentHomeType !== '';
      case 102:
        return answers.currentBedrooms !== '' && answers.currentBathrooms !== '';
      case 103:
        return answers.currentSqft !== '';
      case 104:
        return answers.lotSize !== '';
      case 105:
        return answers.yearBuilt !== '';
      case 106:
        return answers.lastRenovated !== '';
      case 107:
        return answers.sellingTimeframe !== '';
      case 108:
        return answers.reasonForSelling !== '';
      case 109:
        return answers.expectedPrice !== '';
      case 200:
        return answers.firstName !== '' && answers.lastName !== '';
      case 201:
        return answers.email !== '' && answers.phone !== '';
      case 202:
        return answers.contactPreference !== '';
      case 203:
        return answers.agreeToTerms === true;
      default:
        return true;
    }
  };

  // Function to handle navigation logic
  const handleNavigation = () => {
    // Case for buyer path
    if (answers.userType === 'buyer' && currentStep === 9) {
      setCurrentStep(200); // Jump to contact info
      return;
    }
    
    // Case for seller path
    if (answers.userType === 'seller' && currentStep === 109) {
      setCurrentStep(200); // Jump to contact info
      return;
    }
    
    // Case for both paths (after seller info)
    if (answers.userType === 'both' && currentStep === 109) {
      setCurrentStep(200); // Jump to contact info
      return;
    }
    
    // Case for review
    if (currentStep === 202) {
      setCurrentStep(203); // Review page
      return;
    }
    
    // Submit case
    if (currentStep === 203) {
      handleSubmit();
      return;
    }
    
    // Default next step
    nextStep();
  };

  // Calculate progress percentage
  const calculateProgress = () => {
    const totalSteps = answers.userType === 'buyer' ? 13 : 
                      answers.userType === 'seller' ? 14 : 
                      answers.userType === 'both' ? 24 : 1;
    
    let currentProgress = currentStep;
    
    // Adjust for jumps in step numbers
    if (currentStep >= 100 && currentStep < 200) {
      currentProgress = currentStep - 90;
    } else if (currentStep >= 200) {
      currentProgress = totalSteps - 3 + (currentStep - 200);
    }
    
    return Math.min(Math.round((currentProgress / totalSteps) * 100), 100);
  };

  return (
    <div className="bg-white min-h-screen">
      <div className="max-w-3xl mx-auto p-4 sm:p-6 py-8">
        {/* Header */}
        <div className="flex items-center mb-8">
          <div className="mr-4">
            <Home size={32} className="text-blue-600" />
          </div>
          <div>
            <h1 className="text-2xl font-bold text-blue-600">Agent Ally</h1>
            <p className="text-gray-600">Buy and sell with 0% commission using AI</p>
          </div>
        </div>
        
        {/* Progress bar */}
        {currentStep !== 0 && currentStep !== 1000 && (
          <div className="mb-8">
            <div className="h-2 bg-gray-200 rounded-full overflow-hidden">
              <div 
                className="h-full bg-blue-600 rounded-full" 
                style={{ width: `${calculateProgress()}%` }}
              ></div>
            </div>
            <div className="flex justify-between mt-2 text-xs text-gray-500">
              <span>Start</span>
              <span>Halfway</span>
              <span>Complete</span>
            </div>
          </div>
        )}
        
        {/* Form content */}
        <div className="bg-white rounded-lg p-6 shadow-sm border border-gray-100">
          {/* Step 0: User Type Selection */}
          {currentStep === 0 && (
            <div className="space-y-6">
              <h2 className="text-2xl font-bold text-center mb-6">Welcome to Agent Ally</h2>
              <p className="text-lg text-center mb-6">Are you interested in buying or selling a property?</p>
              
              <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button 
                  className={`p-6 rounded-lg border-2 flex flex-col items-center ${answers.userType === 'buyer' ? 'border-blue-500 bg-blue-50' : 'border-gray-200'}`}
                  onClick={() => handleChange('userType', 'buyer')}
                >
                  <Home size={40} className={answers.userType === 'buyer' ? 'text-blue-500' : 'text-gray-400'} />
                  <span className="mt-2 font-medium">I'm Buying</span>
                </button>
                
                <button 
                  className={`p-6 rounded-lg border-2 flex flex-col items-center ${answers.userType === 'seller' ? 'border-blue-500 bg-blue-50' : 'border-gray-200'}`}
                  onClick={() => handleChange('userType', 'seller')}
                >
                  <DollarSign size={40} className={answers.userType === 'seller' ? 'text-blue-500' : 'text-gray-400'} />
                  <span className="mt-2 font-medium">I'm Selling</span>
                </button>
                
                <button 
                  className={`p-6 rounded-lg border-2 flex flex-col items-center ${answers.userType === 'both' ? 'border-blue-500 bg-blue-50' : 'border-gray-200'}`}
                  onClick={() => handleChange('userType', 'both')}
                >
                  <div className="flex">
                    <Home size={32} className={answers.userType === 'both' ? 'text-blue-500' : 'text-gray-400'} />
                    <DollarSign size={32} className={answers.userType === 'both' ? 'text-blue-500' : 'text-gray-400'} />
                  </div>
                  <span className="mt-2 font-medium">I'm Doing Both</span>
                </button>
              </div>
            </div>
          )}

          {/* Step 1: Location */}
          {currentStep === 1 && (
            <div className="space-y-6">
              <h2 className="text-xl font-bold">Where are you looking to buy?</h2>
              <div className="space-y-4">
                <label className="block">
                  <span className="text-gray-700">Preferred location (City, State, or Zip Code)</span>
                  <div className="mt-1 relative">
                    <MapPin className="absolute top-3 left-3 text-gray-400" size={18} />
                    <input
                      type="text"
                      id="location"
                      name="location"
                      value={answers.location}
                      onChange={(e) => handleChange('location', e.target.value)}
                      className="w-full pl-10 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="Enter city, state, or zip code"
                    />
                  </div>
                </label>
              </div>
            </div>
          )}

          {/* Step 2: Budget */}
          {currentStep === 2 && (
            <div className="space-y-6">
              <h2 className="text-xl font-bold">What's your budget?</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <label className="block">
                  <span className="text-gray-700">Minimum price</span>
                  <div className="mt-1 relative">
                    <DollarSign className="absolute top-3 left-3 text-gray-400" size={18} />
                    <input
                      type="number"
                      id="priceMin"
                      name="priceMin"
                      value={answers.priceMin}
                      onChange={(e) => handleChange('priceMin', e.target.value)}
                      className="w-full pl-10 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="Min price"
                    />
                  </div>
                </label>
                
                <label className="block">
                  <span className="text-gray-700">Maximum price</span>
                  <div className="mt-1 relative">
                    <DollarSign className="absolute top-3 left-3 text-gray-400" size={18} />
                    <input
                      type="number"
                      id="priceMax"
                      name="priceMax"
                      value={answers.priceMax}
                      onChange={(e) => handleChange('priceMax', e.target.value)}
                      className="w-full pl-10 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                      placeholder="Max price"
                    />
                  </div>
                </label>
              </div>
            </div>
          )}

          {/* Step 3: Bedrooms and Bathrooms */}
          {currentStep === 3 && (
            <div className="space-y-6">
              <h2 className="text-xl font-bold">How many bedrooms and bathrooms do you need?</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <label className="block">
                  <span className="text-gray-700">Bedrooms</span>
                  <div className="mt-1 relative">
                    <BedDouble className="absolute top-3 left-3 text-gray-400" size={18} />
                    <select
                      id="bedrooms"
                      name="bedrooms"
                      value={answers.bedrooms}
                      onChange={(e) => handleChange('bedrooms', e.target.value)}
                      className="w-full pl-10 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="">Select</option>
                      <option value="1">1+ bedrooms</option>
                      <option value="2">2+ bedrooms</option>
                      <option value="3">3+ bedrooms</option>
                      <option value="4">4+ bedrooms</option>
                      <option value="5">5+ bedrooms</option>
                    </select>
                  </div>
                </label>
                
                <label className="block">
                  <span className="text-gray-700">Bathrooms</span>
                  <div className="mt-1 relative">
                    <Bath className="absolute top-3 left-3 text-gray-400" size={18} />
                    <select
                      id="bathrooms"
                      name="bathrooms"
                      value={answers.bathrooms}
                      onChange={(e) => handleChange('bathrooms', e.target.value)}
                      className="w-full pl-10 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="">Select</option>
                      <option value="1">1+ bathrooms</option>
                      <option value="1.5">1.5+ bathrooms</option>
                      <option value="2">2+ bathrooms</option>
                      <option value="2.5">2.5+ bathrooms</option>
                      <option value="3">3+ bathrooms</option>
                      <option value="3.5">3.5+ bathrooms</option>
                      <option value="4">4+ bathrooms</option>
                    </select>
                  </div>
                </label>
              </div>
            </div>
          )}

          {/* Add other steps as needed */}

          {/* Navigation buttons */}
          {currentStep !== 0 && currentStep !== 1000 && (
            <div className="flex justify-between mt-8">
              <button
                onClick={() => setCurrentStep(currentStep === 203 ? 202 : Math.max(0, currentStep - 1))}
                className="px-6 py-2 border border-gray-300 rounded-full text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
              >
                Back
              </button>
              
              <button
                onClick={handleNavigation}
                disabled={!canProceed()}
                className={`px-6 py-2 rounded-full flex items-center ${canProceed() ? 'bg-blue-600 text-white hover:bg-blue-700' : 'bg-gray-300 text-gray-500 cursor-not-allowed'} focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2`}
              >
                {currentStep === 203 ? 'Submit' : 'Next'}
                <ArrowRight size={16} className="ml-2" />
              </button>
            </div>
          )}
          
          {currentStep === 0 && (
            <div className="flex justify-center mt-8">
              <button
                onClick={nextStep}
                disabled={!canProceed()}
                className={`px-8 py-3 rounded-full flex items-center ${canProceed() ? 'bg-blue-600 text-white hover:bg-blue-700' : 'bg-gray-300 text-gray-500 cursor-not-allowed'} focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2`}
              >
                Get Started
                <ArrowRight size={16} className="ml-2" />
              </button>
            </div>
          )}
        </div>
      </div>
    </div>
  );
};

export default AgentAllySurvey;
